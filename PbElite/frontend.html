<!DOCTYPE html> 
<html>
	<head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <title>Powerblock Elite</title>
        <style type="text/css">
            tr.spacing > td
            {
                padding-top: 5px;
                padding-bottom: 5px;
            }
        </style>

        <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet"/>
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css" rel="stylesheet"/>
        <link href="//cdnjs.cloudflare.com/ajax/libs/jquery-ui-bootstrap/0.5pre/assets/css/bootstrap.min.css" rel="Stylesheet" />

        <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.js"></script>
        <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <script type="text/javascript">
            function changeVal(circuitNum) {
                var circuit = document.getElementById('circuit' + circuitNum);
                var login = 1;
                $.ajax({
                    type: "POST",
                    url: "/updateCircuit/" + login + "/" + circuitNum + "/" + (circuit.value == "true" ? "0" : "1") + "/",
                    success: function (data) {
                        console.log(data);
                        console.log(data['result']);

                        if (data['result'] == "0") {
                            circuit.value = "false";
                            document.getElementById("display" + circuitNum).innerHTML = "off"
                        } else {
                            circuit.value = "true";
                            document.getElementById("display" + circuitNum).innerHTML = "on"
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        console.log("error: " + errorThrown);
                    }
                });
            } 
	    </script>
    </head>
    
	<body>
        <div class="navbar navbar-default">
            <div class="navbar-inner">
                
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="frontend.html">Home</a></li>
                        <li><a href="">Account</a></li>
                    </ul>
                
            </div>
        </div>
        <div class="container">
            <div id="mainDiv" class="hero-unit"> 
                <h1> 
		            Welcome to the Powerblock Elite UI! 
	            </h1> 
                <script type="text/javascript">
                    var html = '';

                    var login = 1;
                    $.getJSON("/circuits/" + login + "/", function (circuits) {
                        var contents = '<table>';
                        for (i in circuits) {
                            contents += '<tr class="spacing">';
                            contents += '<td><span><input type="hidden" id="circuit' + circuits[i].num + '" value="' + circuits[i].state + '" /></span>';
                            contents += '<span>' + circuits[i].name + ' is currently </span>';
                            contents += '<span id="display' + circuits[i].num + '">' + (circuits[i].state == true ? "on" : "off") + '</span><td>';
                            //contents += '<td style="padding-left: 20px"><button class="btn btn-sm btn-success" type="submit" onclick="changeVal(' + circuits[i].num + ')">Turn On/Off</button><td>';
                            contents += '<td><div class="btn-group btn-toggle" style="padding-left:20px">';
                            contents += '<button class=' +(circuits[i].state == true ? '"btn btn-primary active"' : '"btn btn-default"')+ 'onclick="changeVal(' + circuits[i].num + ')">ON</button>';
                            contents += '<button class='+(circuits[i].state == true ? '"btn btn-default"' : '"btn btn-primary active"') +'onclick="changeVal(' + circuits[i].num + ')">OFF</button>';
                            contents += '</div></td>';
                            contents += '</tr>';
                        }
                        contents += "</table>";
                        document.getElementById('mainDiv').innerHTML += contents;

                        $('.btn-toggle').click(function () {
                            $(this).find('.btn').toggleClass('active');

                            if ($(this).find('.btn-primary').size() > 0) {
                                $(this).find('.btn').toggleClass('btn-primary');
                            }
                            if ($(this).find('.btn-danger').size() > 0) {
                                $(this).find('.btn').toggleClass('btn-danger');
                            }
                            if ($(this).find('.btn-success').size() > 0) {
                                $(this).find('.btn').toggleClass('btn-success');
                            }
                            if ($(this).find('.btn-info').size() > 0) {
                                $(this).find('.btn').toggleClass('btn-info');
                            }

                            $(this).find('.btn').toggleClass('btn-default');

                        });
                    });

                    
                </script>
            </div>
            <div id="mainDiv2" class="hero-unit">
                <script type="text/javascript">
                var login = 1;
                $.getJSON("/api/grabReadings/" + login + "/", function (circuits){
                        var contents = '<h2>Circuit Readings</h2>';
                        contents += '<table>';
                        contents += '<tr><th style="padding-right: 75px">Circuit Name</th><th style="padding-right: 75px">Power</th><th style="padding-right: 75px">Timestamp</th>';
                        for (circuit in circuits) {
                            
                            
                            //for (reading in circuits[circuit]) {
                                contents += '<tr class="spacing">';
                                contents += '<td>' + circuits[circuit]['name'] + '</td>';
                                contents += '<td>' + circuits[circuit]['power'] + '</td>';
                                contents += '<td>' + circuits[circuit]['timestamp'] + '</td>';
                                contents += '</tr>';
                            //}

                            }
                            contents += '</table>';
                            document.getElementById('mainDiv2').innerHTML += contents;
                    });
                </script>
            </div>
        </div>
	</body> 
</html>